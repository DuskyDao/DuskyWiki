+++
title = 'Iperf'
date = 2024-01-18T09:26:22+02:00
draft = false
+++
#iperf
### Содержание:
1. **[Установка](#установка)**
2. **[Брандмауэр/файрвол](#брандмауэрфайрвол)**
3. **[Запуск](#запуск)**
4. **[Возможные ключи](#возможные-ключи)**
5. **[Примеры](#пример)**
---
**Iperf3** — кроссплатформенная консольная клиент-серверная программа — генератор TCP и UDP трафика для тестирования пропускной способности сети. С ее помощью довольно просто измерить максимальную пропускную способность сети между сервером и клиентом и провести нагрузочное тестирование канала связи.
### **Установка**
В дистрибутивах **Debian/Ubuntu** вы можете установить утилиту iperf3 командой:
```cmd
$ sudo apt install iperf3
```
В дистрибутивах **CentOS/RHEL/Fedora 8** пакет `iperf3` включен в состав базового репозитория AppStream (в CentOS 7 iperf3 есть в EPEL). Вы можете установить его стандартной командой `yum/dnf`:
```cmd
# dnf install iperf3
``` 
Вы можете скачать iperf 3.1 для **Windows** по ссылке https://iperf.fr/iperf-download.php. Достаточно скачать архив iperf и распаковать в локальный каталог на диске. Установка утилиты не требуется.
Для Windows есть несколько реализаций графического интерфейса. Например, **Iperf3-Cygwin-GUI** и **jperf**.\
Утилита **jperf** написана на Java (для работы на компьютере должна быть установлена Java-машина). Помимо графических рюшечек к CLI интерфейсу, **Jperf** умеет в реальном времени строить графики пропускной способности канала связи.
Для использования достаточно указать адрес сервера iPerf и запустить проверку.\
![Jperf](/network/iperf/Jperf.jpg)
### **Брандмауэр/файрвол**
Если вы запускаете `iPerf` сервер на **Windows**, нужно открыть входящие порт `5201` для протоколов TCP и UDP. Можно открыть порты через графический интерфейс Windows Defender Firewall или с помощью команд PowerShell. Создайте и включите правила файервола так:
```powershell
New-NetFirewallRule -DisplayName 'iPerf-Server-Inbound-TCP' -Direction Inbound -Protocol TCP -LocalPort 5201 -Action Allow | Enable-NetFirewallRule
New-NetFirewallRule -DisplayName 'iPerf-Server-Inbound-UDP' -Direction Inbound -Protocol UDP -LocalPort 5201 -Action Allow | Enable-NetFirewallRule 
```
**Debian/Ubuntu** Если данный Linux сервер планируется использовать в качестве сервере iperf3, нужно открыть порт 5201 в firewalld (или iptables):
```cmd
# firewall-cmd --permanent --add-port=5201/tcp
# firewall-cmd --permanent --add-port=5201/udp
# firewall-cmd --reload 
```
### **Запуск**
>**Iperf** это консольная утилита, которая работает в связке **сервер - клиент**. Для ее запуска нужно использовать командную строку. Откройте командную строку (cmd.exe) и перейдите в каталог с утилитой. Например:
```cmd
cd c:\tools\iperf
```
##### На стороне **сервера** для запуска:
```cmd
iperf3 -s
```
Можно запустить iperf сервер с большим размером TCP окна и на другом порту:
```cmd
# iperf3 -s -w 32768 –p 5203
```
- -w 32768 – зададим размер окна TCP в 32 KB (по умолчанию около 8 Кб)
- –p 5203 – порт, на котором ожидает подключения iperf (напоминаю, что iperf2 по умолчанию слушает на порту 5001). 
  
##### **На клиенте**
```cmd
iperf3 -c <адрес_сервера_iperf3> 
```
> :bell: **Важно!** По умолчанию программа `iperf3` выполняет передачу трафика от клиента на сервер, использует протокол TCP, тестирование выполняется 10 секунд и без ограничения максимальной скорости.\
При измерении беспроводного подключения рекомендуется включать режим Reverse Mode для тестирования входящей скорости на клиенте (в этом случае сервер передает данные, а клиент принимает). Добавляйте в команду ключ `-R`. При тестировании Wi-Fi-подключения вы можете наблюдать, что цифры полученных скоростей значительно отличаются, что является нормальным и связано с особенностью среды передачи данных в сетях Wi-Fi.
### **Возможные ключи**
| Возможные ключи | Значение                                                                                                                       |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `-R`            | рекурсивная проверка                                                                                                           |
| `-c`            | адрес сервера                                                                                                                  |
| `-w`            | увеличиваем размер TCP окна (например 32768)                                                                                   |
| `-t`            | время в секундах, в течении которого выполняется тестирование (по умолчанию 10 секунд)                                         |
| `-P`            | число параллельных потоков (подключений), используется для получения максимальной нагрузки на канал                            |
| `-i`            | выводить статистику на экран каждые 5 секунд. Параметр удобно использовать при продолжительных тестах (несколько минут, часов) |
| `-f m`          | выводить результаты в Мбит/с. Здесь можно использовать атрибуты kmgKMG (килобиты, мегабиты, мегабайты и т.д.)                  |
| `–u`            | проверить скорость по UDP протоколу (по умолчанию ТСР)                                                                         |
| `–d`            | Если нужно оценить пропускную способность сети в обоих направлениях (в дуплексном режиме)(с клиента)                           |
### **Пример:**
```cmd
iperf3.exe -c 192.168.10.11 -P 8 -t 30 -w 32768 -d
```
В данном случае - мы тестируем хост 192.168.10.11, в 8потоков, продолжительностью в 30секунд, с размером пакетов  32768Кбит, в двух направлениях.
### **Сноски:**
> :mega: Обратите внимание, что iperf3 не поддерживает несколько одновременных тестов. Если сервер iperf сейчас выполняет тестирование с одним клиентов, то при попытке подключиться к нему с другого вы получите ошибку: iperf3: error — the server is busy running a test. try again later.

> :mega: Если вам нужно проверить ваш интернет-канал (предоставляемый провайдером), можно воспользоваться одним из публичных iperf серверов (список доступен [здесь](https://iperf.fr/iperf-servers.php)):
```cmd
iperf3 -c iperf.it-north.net
```
Полный список опций утилиты iperf можно получить так:
```cmd
iperf3 –help
```
| :arrow_up: [В начало](#содержание) |
| ---: | 