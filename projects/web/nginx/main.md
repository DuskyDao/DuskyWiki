### Запуск, остановка, перезагрузка конфигурации
Чтобы запустить nginx, нужно выполнить исполняемый файл. Когда nginx запущен, им можно управлять, вызывая исполняемый файл с параметром `-s`. Используйте следующий синтаксис:

```bash
nginx -s сигнал
```
Где *сигнал* может быть одним из нижеследующих:
- `stop` — быстрое завершение
- `quit` — плавное завершение
- `reload` — перезагрузка конфигурационного файла
- `reopen` — переоткрытие лог-файлов

Например, чтобы остановить процессы nginx с ожиданием окончания обслуживания текущих запросов рабочими процессами, можно выполнить следующую команду:
```bash
nginx -s quit
```
> Команда должна быть выполнена под тем же пользователем, под которым был запущен nginx.

Изменения, сделанные в конфигурационном файле, не будут применены, пока команда перезагрузить конфигурацию не будет вручную отправлена nginx’у или он не будет перезапущен. Для перезагрузки конфигурации выполните:
```bash
nginx -s reload
```
Получив сигнал, главный процесс проверяет правильность синтаксиса нового конфигурационного файла и пытается применить конфигурацию, содержащуюся в нём. Если это ему удаётся, главный процесс запускает новые рабочие процессы и отправляет сообщения старым рабочим процессам с требованием завершиться. В противном случае, главный процесс откатывает изменения и продолжает работать со старой конфигурацией. Старые рабочие процессы, получив команду завершиться, прекращают принимать новые запросы и продолжают обслуживать текущие запросы до тех пор, пока все такие запросы не будут обслужены. После этого старые рабочие процессы завершаются.

Посылать сигналы процессам nginx можно также средствами Unix, такими как утилита `kill`. В этом случае сигнал отправляется напрямую процессу с данным ID. ID главного процесса nginx записывается по умолчанию в файл `nginx.pid` в каталоге `/usr/local/nginx/logs` или `/var/run`. Например, если ID главного процесса равен 1628, для отправки сигнала QUIT, который приведёт к плавному завершению nginx, нужно выполнить:
```bash
kill -s QUIT 1628
```
Для просмотра списка всех запущенных процессов nginx может быть использована утилита `ps`, например, следующим образом:
```bash
ps -ax | grep nginx
```
Дополнительную информацию об отправке сигналов процессам nginx можно найти в [Управление nginx](https://nginx.org/ru/docs/control.html).
### Права доступа к файлам и папкам на хостинге
Почему после загрузки корректно настроенного сайта на хостинг могут отображаться ошибки с кодом 403 или 500? Причиной их возникновения могут быть некорректные права на файлы и/или папки сайта.

Некорректные права могут быть установлены при переносе файлов с другого хостинг-сервера или во время загрузки файлов с локального компьютера.

**Какие права доступа следует использовать и почему так?**

Обычно для корректной работы сайта следует использовать такие права:
- **для папок — 755,**
-  **для файлов — 644**.

Права доступа 644 предполагают такие привилегии:
- владелец файла может читать и редактировать файл,
- группа пользователей, к которой принадлежит владелец файла, могут только читать файл,
- другие пользователи также могут только читать файл.
##### Задать права 644 для файлов
Чтобы задать права 644 для всех файлов в каталоге, можно также использовать команду `find` вместе с `chmod`. Вот как это сделать:
1. Перейдите в нужный каталог:
```bash
cd /путь/к/каталогу
```
- Используйте следующую команду для поиска всех файлов и изменения их прав доступа:
```bash
find . -type f -exec chmod 644 {} +
```
Разбор команды:
- `find .`: запускает поиск в текущем каталоге (замените `.` на другой путь, если хотите выполнить команду в другом каталоге).
- `-type f`: указывает, что нужно искать только файлы.
- `-exec chmod 644 {} +`: для каждого найденного файла выполняет команду `chmod 644`, где `{}` заменяется на путь к найденному файлу.

Эта команда рекурсивно задаст права 644 всем файлам в указанном каталоге.
Права доступа 755 предполагают такие привилегии:
- владелец папки может редактировать содержимое папки, выполнять чтение или входить в папку,
- группа пользователей, к которой принадлежит владелец папки, могут выполнять только чтение и вход в папку,
- другие пользователи могут выполнять только чтение и вход в папку.
##### Задать права 755 на все подпапки
Для того чтобы задать права доступа 755 на все папки в каталоге, можно использовать команду `find` вместе с `chmod`. Вот как это сделать:
1. Перейдите в нужный каталог:
```bash
cd /путь/к/каталогу
```
- Используйте следующую команду для поиска всех папок и изменения их прав доступа:
```bash
find . -type d -exec chmod 755 {} +
``` 
Разбор команды:
- `find .`: запускает поиск в текущем каталоге (замените `.` на другой путь, если хотите выполнить команду в другом каталоге).
- `-type d`: указывает, что нужно искать только директории (папки).
- `-exec chmod 755 {} +`: для каждой найденной директории выполняет команду `chmod 755`, где `{}` заменяется на путь к найденной директории.

Эта команда рекурсивно задаст права 755 всем папкам в указанном каталоге.
В случае использования таких прав владелец сайта может свободно работать с настройкой и использованием сайта. При этом соблюдаются меры безопасности, которые не позволят изменить содержимое файлов и папок другим пользователям.

**Проверить конфиг файл**
```shell
gninx -t
```
### Блоки **location**
В конфигурации Nginx блоки `location` используются для определения правил обработки запросов к различным URL-адресам. Блоки `location` могут использовать разные типы префиксов для определения, какие запросы соответствуют определённым правилам. Вот краткое описание различных типов префиксов и их использование:
**Типы префиксов в `location`:**
##### Префикс с обычным совпадением (без символа)
Этот префикс используется для обычного (префиксного) совпадения с началом URI. 
```nginx
location /cats {     
	# Действия для совпадения всех URI, начинающихся с /cats
	return 200 'Любая ссылка имеющая в себе "cats"';
}
``` 
##### Префикс с точным совпадением (`=`)
Этот префикс используется для точного совпадения запроса с заданным URI.
```nginx
location = /cats {
	# Действия для точного совпадения с URI /cats
	return 200 'Только ссылка "/cats"';
}
```
##### Префикс с символом `~`:
Этот префикс указывает Nginx, что если этот блок location имеет регулярные выражения.
```nginx
location ~ /cats[0-9] {     
# Действия для совпадения всех URI, начинающихся с /cats*, где * - цифры
	return 200 'Сылка с регулярный выражением "/cats34"';
}
```
> **`~`** используется для чувствительных к регистру регулярных выражений.
##### Префикс с символом `^~`
Этот префикс указывает Nginx, что если этот блок location соответствует, то не нужно проверять регулярные выражения.
```nginx
location ^~ /ignore-regex {     
# Действия для совпадения всех URI, начинающихся с /ignore-regex, без проверки регулярных выражений 
}
```
##### Префикс с регулярными выражениями (`~` и `~*`)
- `~*` используется для нечувствительных к регистру регулярных выражений.
```nginx
location ~ \.php$ {     
# Действия для URI, оканчивающихся на .php (чувствительно к регистру) 
}
location ~* \.(jpg|jpeg|png|gif)$ {     
# Действия для URI, оканчивающихся на .jpg, .jpeg, .png или .gif (нечувствительно к регистру) 
}
```   
##### Префикс с символом `/` (базовый блок)
Этот блок обрабатывает все запросы, если другие блоки location не подходят.
```nginx
location / {
    # Действия по умолчанию для всех запросов
}
```
##### Порядок совпадений (приоритет)
1. `=` - полное совпадение
2. `^~` - префикс преимущества
3. `~&*~` - регулярные выражения
4. `без модификатора` - совпадение префикса (без модификатора) 
##### Пример:
Создадим папку с картинками по адресу /home/dusky/downloads/
```nginx
events {}
http {
	include mime.types;
	server {
		listen 80;
		server_name 192.168.23.12;
		root /home/dusky/fesukr;
		
		location /downloads {
			root /home/dusky;
			try_files $uri =404;
		}
	}
}
```
> Теперь при обращении 
> http://192.168.23.12/downloads/img/page/contacts/mane_foto.jpg 
> у нас откроется картинка 
### Loging
##### error_log
|Синтаксис:|``**error_log** `_файл_` [`_уровень_`];``|
|---|---|
|Умолчание:|error_log logs/error.log error;|
|Контекст:|`main`, `http`, `mail`, `stream`, `server`, `location`|

Конфигурирует запись в лог. На одном уровне конфигурации может использоваться несколько логов (1.5.2). Если на уровне конфигурации `main` запись лога в файл явно не задана, то используется файл по умолчанию.

Первый параметр задаёт `_файл_`, который будет хранить лог. Специальное значение `stderr` выбирает стандартный файл ошибок. Запись в [syslog](https://nginx.org/ru/docs/syslog.html) настраивается указанием префикса “`syslog:`”. Запись в [кольцевой буфер в памяти](https://nginx.org/ru/docs/debugging_log.html#memory) настраивается указанием префикса “`memory:`” и `_размера_` буфера и как правило используется для отладки (1.7.11).

Второй параметр определяет `_уровень_` лога и может принимать одно из следующих значений: `debug`, `info`, `notice`, `warn`, `error`, `crit`, `alert` или `emerg`. Уровни лога, указанные выше, перечислены в порядке возрастания важности. При установке определённого уровня в лог попадают все сообщения указанного уровня и уровней большей важности. Например, при стандартном уровне `error` в лог попадают сообщения уровней `error`, `crit`, `alert` и `emerg`. Если этот параметр не задан, используется `error`.

> Для работы уровня лога `debug` необходимо сконфигурировать nginx с `--with-debug`, см. “[Отладочный лог](https://nginx.org/ru/docs/debugging_log.html)”.

> Директива может быть указана на уровне `stream` начиная с версии 1.7.11 и на уровне `mail` начиная с версии 1.9.0.
##### debug_connection
| Синтаксис: | ``**debug_connection** `_адрес_` \| `_CIDR_` \| `unix:`;`` |
| ---------- | ---------------------------------------------------------- |
| Умолчание: | —                                                          |
| Контекст:  | `events`                                                   |

Включает отладочный лог для отдельных клиентских соединений. Для остальных соединений используется уровень лога, заданный директивой [error_log](https://nginx.org/ru/docs/ngx_core_module.html#error_log). Отлаживаемые соединения задаются IPv4 или IPv6 (1.3.0, 1.2.1) адресом или сетью. Соединение может быть также задано при помощи имени хоста. Отладочный лог для соединений через UNIX-сокеты (1.3.0, 1.2.1) включается параметром “`unix:`”.
```nginx
> events {
>     debug_connection 127.0.0.1;
>     debug_connection localhost;
>     debug_connection 192.0.2.0/24;
>     debug_connection ::1;
>     debug_connection 2001:0db8::/32;
>     debug_connection unix:;
>     ...
> }
```
> Для работы директивы необходимо сконфигурировать nginx с параметром `--with-debug`, см. “[Отладочный лог](https://nginx.org/ru/docs/debugging_log.html)”.
##### Отключение логов
Отключим логирование для папки /downloads, что бы не перегружать сервер ненужныеми записями на доступ к картинкам
```nginx
user dusky;
error_log /var/log/nginx/error.log;

events {}

http {
  include mime.types;

  server {
    listen 80;
    server_name 192.168.23.12;
    root /home/dusky/fesukr;
    #index index.html index.htm;

    location = /greet {
      return 200 'Hello lyagushonok html\n';
    }
    location /downloads {
      root /home/dusky;
      try_files $uri =404;
      error_log off;
      access_log off; 

    }
  }
}
```

### Материалы взяты:
1. [Официальная документация](https://nginx.org/ru/docs/)
2. ChatGPT