### Подключение базы данных к проекту
Подключение определяется в файле `settings.py` в коллекции **DATABASES**
```python
# Database
# https://docs.djangoproject.com/en/5.1/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```
#### Создаем первую таблицу в базе
Работа с базами в джанго производиться через классы в файлах миграций, в которых мы задаем структуру наших таблиц, обновляем данные и тд.

Каталог и сам файл миграций создается автоматически движком, нам нужно только создать в нем класс таблици. Делается это прописыванием класса таблици в файле `models.py`. 

Для примера, создадим таблицу `women` с такими столбцами в `models.py`
> путь `sitewomen>women>models.py`

![](files/table.png)
```python
from django.db import models

# Create your models here.
class Women(models.Model):
    title = models.CharField(max_length=255)  # название статьи
    content = models.TextField(blank=True)  # текстовое поле, blank=True - можно не заполнять при создании
    time_create = models.DateTimeField(auto_now_add=True)  # время создания
    time_update = models.DateTimeField(auto_now=True)  # время обновления
    is_published = models.BooleanField(default=True)  # по умолчанию - опубликовано
```
> описание всех полей можно глянуть в оф [документации](https://docs.djangoproject.com/en/4.2/ref/models/fields/)

##### Создаем миграцию
В консоли виртуального окружения, в папке проекта прописываем `python manage.py makemigrations`
```cmd
(djvenv) PS D:\python\django\sitewomen> python manage.py makemigrations
Migrations for 'women':
  women\migrations\0001_initial.py
    + Create model Women
```
Движек автоматически создаст файл миграции в папке `sitewomen>women>migrations/0001_initial.py`
```python
# Generated by Django 5.1.4 on 2025-01-12 19:12

from django.db import migrations, models

class Migration(migrations.Migration):
    initial = True
    dependencies = [
    ]

	operations = [
        migrations.CreateModel(
            name='Women',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('content', models.TextField(blank=True)),
                ('time_create', models.DateTimeField(auto_now_add=True)),
                ('time_update', models.DateTimeField(auto_now=True)),
                ('is_published', models.BooleanField(default=True)),
            ],
        ),
    ]
```
Можно посмотреть сформированный sql запрос с выше созданной миграции введя её идентефикатор 
```sql
python manage.py sqlmigrate women 0001

# вывод
BEGIN;
--
-- Create model Women
--
CREATE TABLE "women_women" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" varchar(255) NOT NULL, "content" text NOT NULL, "time_create" datetime NOT NULL, "time_update" datetime NOT NULL, "is_published" bool NOT NULL);
COMMIT;
```
##### Применяем миграцию создавая в базе данных таблицу
В консоли
```cmd
python manage.py sqlmigrate
```
Таблица создана (при первой миграции создаются ещё много вспомагательных таблиц, типа админ панели, авторизации и тд.)
```cmd
(djvenv) PS D:\python\django\sitewomen> python manage.py migrate              
Operations to perform:
  Apply all migrations: admin, auth, contenttypes, sessions, women
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying sessions.0001_initial... OK
  Applying women.0001_initial... OK
```
Видим все таблице в базе
![](files/Pasted%20image%2020250112221143.png)
#### Добавляем данные в таблицу
##### Добавление данных происходит посредством встроенного ORM, c shell оболочки движка джанго
```sql
python manage.py shell

#вывод
Python 3.13.0 (tags/v3.13.0:60403a5, Oct  7 2024, 09:38:07) [MSC v.1941 64 bit (AMD64)] on win32
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
>>>
```
##### Импортируем модель c women приложения (нашу таблицу **women** с класса **Women**)
```sql
>>> from women.models import Women
```
##### Добавим данные в таблицу через класс **Women**
```sql
>>> Women(title='Анджелина Джоли', content='Биография Анджелині Джоли')
```
##### Присвоим переменной наш єкземпляр класса
```sql
>>> w1 = _
```
> _ последняя введенная команда
##### Сохраним в баззу
```sql
>>> w1.save()
```
##### Можно мосмотреть вывод нашей переменной
```sql
>>> w1
<Women: Women object (1)>

>>> w1.id
1

>>> w1.title
'Анджелина Джоли'

>>> w1.time_create
datetime.datetime(2025, 1, 12, 20, 59, 47, 727924, tzinfo=datetime.timezone.utc)
```
##### Посмотреть тело запроса
```sql
>>> from django.db import connection
>>> connection
<django.utils.connection.ConnectionProxy object at 0x000002511A281310>
>>> connection.queries  
[{'sql': 'INSERT INTO "women_women" ("title", "content", "time_create", "time_update", "is_published") VALUES (\'Анджелина Джоли\', \'Биография Анджелині Джоли\', \'2025-01-12 20:59:47.727924\', \'2025-01-12 20:59:47.727954\', 1) RETURNING "women_women"."id"', 'time': '0.001'}]
```
Последний запрос
```sql
>>> connection.queries[-1] 
{'sql': 'INSERT INTO "women_women" ("title", "content", "time_create", "time_update", "is_published") VALUES (\'Анджелина Джоли\', \'Биография Анджелині Джоли\', \'2025-01-12 20:59:47.727924\', \'2025-01-12 20:59:47.727954\', 1) RETURNING "women_women"."id"', 'time': '0.001'}
```
Добавим ещё данных
```sql
>>> w2 = Women(title='Энн Хэтэуей', content='Биография Энн Хэтэуей')
>>> w2
<Women: Women object (None)>
>>> w2.save()
>>> connection.queries[-1]
{'sql': 'INSERT INTO "women_women" ("title", "content", "time_create", "time_update", "is_published") VALUES (\'Энн Хэтэуей\', \'Биография Энн Хэтэуей\', \'2025-01-12 21:15:00.829291\', \'2025-01-12 21:15:00.829320\', 1) RETURNING "women_women"."id"', 'time': '0.001'}
>>> connection.queries    
[{'sql': 'INSERT INTO "women_women" ("title", "content", "time_create", "time_update", "is_published") VALUES (\'Анджелина Джоли\', \'Биография Анджелині Джоли\', \'2025-01-12 20:59:47.727924\', \'2025-01-12 20:59:47.727954\', 1) RETURNING "women_women"."id"', 'time': '0.001'}, {'sql': 'INSERT INTO "women_women" ("title", "content", "time_create", "time_update", "is_published") VALUES (\'Энн Хэтэуей\', \'Биография Энн Хэтэуей\', \'2025-01-12 21:15:00.829291\', \'2025-01-12 21:15:00.829320\', 1) RETURNING "women_women"."id"', 'time': '0.001'}]
```
Можно так
```sql
>>> w3 = Women()
>>> w3.title='Джулия Робертс'
>>> w3.content='Биография Джулии Робертс' 
>>> w3.save()
```